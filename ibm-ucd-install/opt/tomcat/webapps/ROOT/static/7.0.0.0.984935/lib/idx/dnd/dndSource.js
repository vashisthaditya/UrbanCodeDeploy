//>>built
define("idx/dnd/dndSource","dojo/_base/array,dojo/_base/connect,dojo/_base/declare,dojo/dom-geometry,dijit/tree/dndSource,dijit/tree/_dndSelector,./Manager".split(","),function(k,l,m,n,o,j,f){return m("idx.dnd.dndSource",[o],{_onDragMouse:function(a){var d=f.manager(),b=this.targetAnchor,c=this.current,i=this.dropPosition,e="Over";if(c&&0<this.betweenThreshold){if(!this.targetBox||b!=c)this.targetBox=n.position(c.rowNode,!0);a.pageY-this.targetBox.y<=this.betweenThreshold?e="Before":a.pageY-this.targetBox.y>=
this.targetBox.h-this.betweenThreshold&&(e="After")}if(c!=b||e!=i){b&&this._removeItemClass(b.rowNode,i);c&&this._addItemClass(c.rowNode,e);if(c)if(c==this.tree.rootNode&&"Over"!=e)d.canDrop(!1);else{a=!1;if(d.source==this)for(var h in this.selection)if(this.selection[h].item===c.item){a=!0;break}a?d.canDrop(!1):this.checkItemAcceptance(c.rowNode,d.source,e.toLowerCase())&&!this._isParentChildDrop(d.source,c.rowNode)?d.canDrop(!0):d.canDrop(!1)}else d.canDrop(!1);this.targetAnchor=c;this.dropPosition=
e}},onMouseMove:function(a){if(!(this.isDragging&&"Disabled"==this.targetState)){j.prototype.onMouseMove.apply(this,arguments);var d=f.manager();if(this.isDragging)this._onDragMouse(a);else if(this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>=this.dragThreshold||Math.abs(a.pageY-this._lastY)>=this.dragThreshold)){var b=this.getSelectedTreeNodes();if(b.length){if(1<b.length){var c=this.selection,i=0,e=[],h,g;a:for(;h=b[i++];){for(g=h.getParent();g&&g!==this.tree;g=g.getParent())if(c[g.id])continue a;
e.push(h)}b=e}b=k.map(b,function(a){return a.domNode});d.startDrag(this,b,this.copyState(l.isCopyKey(a)))}}}},onDndSourceOver:function(a){this!=a?(this.mouseDown=!1,this._unmarkTargetAnchor()):this.isDragging&&f.manager().canDrop(!1)},onDndStart:function(a,d,b){this.isSource&&this._changeState("Source",this==a?b?"Copied":"Moved":"");this._changeState("Target",this.checkAcceptance(a,d)?"":"Disabled");this==a&&f.manager().overSource(this);this.isDragging=!0},onOverEvent:function(){j.prototype.onOverEvent.apply(this,
arguments);f.manager().overSource(this)},onOutEvent:function(){this._unmarkTargetAnchor();var a=f.manager();this.isDragging&&a.canDrop(!1);a.outSource(this);j.prototype.onOutEvent.apply(this,arguments)}})});