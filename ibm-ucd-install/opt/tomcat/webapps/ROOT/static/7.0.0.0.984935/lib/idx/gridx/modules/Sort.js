//>>built
define("idx/gridx/modules/Sort","dojo/_base/declare,dojo/_base/query,dojo/_base/event,dojo/_base/sniff,dojo/string,dojo/keys,dojo/dom,dojo/dom-class,gridx/core/model/extensions/Sort,gridx/core/_Module,dojo/i18n!../nls/Sort".split(","),function(n,h,k,o,l,g,p,i,q,m,j){return m.register(n(m,{name:"sort",forced:["header"],modelExtensions:[q],constructor:function(){this._sortData=[]},getAPIPath:function(){return{sort:this}},preload:function(){var a=this,b=a.grid,c;a.batchConnect([b,"onHeaderCellClick",
"_onClick"],[b,"onHeaderCellMouseOver","reLayout",b.vLayout],[b,"onHeaderCellMouseOut","reLayout",b.vLayout],[b.header,"onRender","_update"]);b.persist&&(c=b.persist.registerAndLoad("sort",function(){return a._sortData}));if((c=c||a.arg("initialOrder"))&&c.length)a._sortData=c,a.model.sort(c)},load:function(){var a=this.grid;this._update();o("ff")&&p.setSelectable(a.header.domNode,!1);this._initFocus();this.loaded.callback()},columnMixin:{sort:function(a,b){var c=this.grid.sort;c._prepareSortData(this.id,
b);return c.sort(c._sortData)},isSorted:function(){return this.grid.sort.isSorted(this.id)},clearSort:function(){this.grid.sort.clear();return this},isSortable:function(){var a=this.grid._columnsById[this.id];return a.sortable||void 0===a.sortable},setSortable:function(a){this.grid._columnsById[this.id].sortable=a;return this}},nested:!0,sort:function(a){this._sortData=a||[];this.model.sort(a);this._updateHeader();return this.grid.body.refresh()},isSorted:function(a){for(var b=this._sortData.length-
1;0<=b;--b){var c=this._sortData[b];if(c.colId===a)return c.decending?-1:1}return 0},clear:function(){this.sort()},getSortData:function(){return this._sortData},_sortData:null,_onClick:function(a){k.stop(a);this._sort(a.columnId,i.contains(a.target,"gridxArrowButtonNode"),a.ctrlKey)},_sort:function(a,b,c){var d=this.grid;this._focusHeaderId=a;this._focusSortArrow=b;if(d.column(a,1).isSortable()&&(b||!d.select||!d.select.column))this._prepareSortData(a,c),this.sort(this._sortData)},_prepareSortData:function(a,
b){var c=!0,d=!1,f=this.grid._columnsById[a].sortable,b=this.arg("nested")&&b;"descend"==f?d=!0:"ascend"!=f&&(c=!1);for(var e,f=this._sortData.length-1;0<=f;--f,e=0)if(e=this._sortData[f],e.colId===a){e.descending=c?d:!e.descending;break}e||(e={colId:a,descending:c&&d},this._sortData.push(e));if(!b)this._sortData=[e]},_getSortModeCls:function(a){return{ascend:"gridxSortAscendOnly",descend:"gridxSortDescendOnly"}[a.isSortable()]||""},_initHeader:function(a){var b=a.headerNode();b.innerHTML=["<div class='gridxSortNode'><div role='presentation' tabindex='0' class='gridxArrowButtonNode ",
this._getSortModeCls(a),"'></div><div class='gridxColCaption'>",a.name(),"</div></div>"].join("");b.removeAttribute("aria-sort");this._setTitle(b,a)},_update:function(){var a=this,b=a.grid;h(".gridxCell",b.header.domNode).forEach(function(c){var d=b.column(c.getAttribute("colid"),1);d.isSortable()&&a._initHeader(d);a._setTitle(c,d)});a._updateHeader()},_setTitle:function(a,b){b.isSortable()&&a.setAttribute("title",l.substitute(this.arg("nested")?j.helpMsg:j.singleHelpMsg,[b.def().tooltip||b.name()]))},
_updateHeader:function(){var a=this.grid;h("[aria-sort]",a.header.domNode).forEach(function(b){this._initHeader(a.column(b.getAttribute("colid"),1))},this);for(var b=0,c=this._sortData.length;b<c;++b){var d=this._sortData[b],f=a.column(d.colId,1),e=f.headerNode();e.innerHTML=["<div class='gridxSortNode ",d.descending?"gridxSortDown":"gridxSortUp","'><div role='presentation' tabindex='0' class='gridxArrowButtonNode ",this._getSortModeCls(f),"'></div><div class='gridxArrowButtonChar'>",d.descending?
"&#9662;":"&#9652;","</div><div class='",1==c?"gridxSortSingle":"gridxSortNested","'>",b+1,"</div><div class='gridxColCaption'>",f.name(),"</div></div>"].join("");e.setAttribute("aria-sort",d.descending?"descending":"ascending");this.arg("nested")&&(d=l.substitute(j.priorityOrder,[b+1]),e.setAttribute("aria-label",f.name()+", "+d))}a.vLayout.reLayout();a.focus&&"header"==a.focus.currentArea()&&this._focus(this._focusHeaderId)},_focusHeaderId:null,_focusSortArrow:!1,_initFocus:function(){var a=this.grid,
b=a.focus;b&&(a.select&&a.select.column?b.registerArea({name:"header",priority:0,focusNode:a.header.domNode,scope:this,doFocus:this._doFocus,onFocus:this._onFocus,connects:[this.connect(a,"onHeaderCellKeyPress","_onKeyPress")]}):this.connect(a,"onHeaderCellKeyDown",function(a){(a.keyCode==g.ENTER||a.keyCode==g.SPACE)&&this._sort(a.columnId,!1,a.ctrlKey)}))},_doFocus:function(a){this._focus(this._focusHeaderId=this._focusHeaderId||this.grid._columns[0].id,a);return!0},_onFocus:function(){this._focusSortArrow=
!1;return!0},_onKeyPress:function(a){switch(a.keyCode){case g.RIGHT_ARROW:case g.LEFT_ARROW:this._moveFocus(a);break;case g.ENTER:case g.SPACE:this._sort(this._focusHeaderId,this._focusSortArrow,a.ctrlKey)}},_moveFocus:function(a){if(this._focusHeaderId){var b,c=this.grid;b=c.isLeftToRight()?1:-1;var d=a.keyCode==g.LEFT_ARROW?-b:b,f=this._focusSortArrow;k.stop(a);b=c.column(this._focusHeaderId,1);var e=b.isSortable();if(!e||f^0>d)b=c.column(b.index()+d);if(b)this._focusHeaderId=b.id,this._focusSortArrow=
b.isSortable()&&(e||0>d)&&!f,this._focus(b.id,a)}},_focus:function(a,b){var c=this.grid.header,d=c.getHeaderNode(a);c._focusNode(d);if(b)c.onMoveToHeaderCell(a,b);this._focusArrow(a)},_focusArrow:function(a){var b=this.grid.header;h(".gridxArrowButtonFocus",b.domNode).forEach(function(a){i.remove(a,"gridxArrowButtonFocus")});if(this._focusSortArrow&&(a=h(".gridxArrowButtonNode",b.getHeaderNode(a))[0]))i.add(a,"gridxArrowButtonFocus"),a.focus()}}))});