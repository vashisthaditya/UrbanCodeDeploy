//>>built
define("idx/layout/MoveableTabContainer","dojo/_base/declare,dojo/_base/lang,dojo/_base/array,dojo/_base/window,dojo/_base/html,dojo/_base/event,dojo/_base/connect,dojo/keys,dojo/dnd/Moveable,dijit/registry,dijit/layout/TabContainer,dijit/layout/TabController,dijit/layout/ScrollingTabController,dijit/layout/ContentPane".split(","),function(h,n,k,f,e,o,l,p,j,i,q,r,m,s){j=h("idx.layout.MoveableTabContainer",[q],{controllerWidget:"idx.layout.MoveableTabController"});m=h("idx.layout.MoveableTabController",
[m],{buttonWidget:"idx.layout.MoveableTabButton",_movingTab:!1,_mock:null,startup:function(){this.inherited(arguments);this.subscribe(this.id+"/idx/tab/move/start","_onMoveStart");this.subscribe(this.id+"/idx/tab/move/end","_onMoveEnd");this.subscribe(this.id+"/idx/tab/move","_onMove");this.connect(this._rightBtn.domNode,"onmouseover","_onRightButtonMouseOver");this.connect(this._leftBtn.domNode,"onmouseover","_onLeftButtonMouseOver");this.connect(this._rightBtn.domNode,"onmouseout","_onScrollMouseOut");
this.connect(this._leftBtn.domNode,"onmouseout","_onScrollMouseOut");this._indicator=e.create("div",{"class":"idxMoveableTabIndicator"},this.containerNode)},onAddChild:function(a,c){this.inherited(arguments);var b=this.pane2button[a.id];if(b)b.page=a,b.tabTopicId=this.id},onRemoveChild:function(a){this.inherited(arguments);this._hideIndicator()},_onMoveStart:function(a){i.byId(this.containerId).selectChild(a.content);this._computeBounds();var c=this.getChildren();this._movingTab=!0;this._tabIndex=
k.indexOf(c,a.target)},onkeypress:function(a){var c=a.keyCode;if(a.ctrlKey||a.metaKey){var b=i.byId(this.containerId),d=b.selectedChildWidget,e=b.getChildren(),g=k.indexOf(e,d),f=0;c===p.RIGHT_ARROW?f=this.isLeftToRight()?1:-1:c===p.LEFT_ARROW?f=this.isLeftToRight()?-1:1:this.inherited(arguments);0<f?g<e.length-1&&(o.stop(a),b.removeChild(d),b.addChild(d,g+1),b.selectChild(d),this.pane2button[d.id].focus()):0>f&&0<g&&(o.stop(a),b.removeChild(d),b.addChild(d,g-1),b.selectChild(d),this.pane2button[d.id].focus())}else this.inherited(arguments)},
_onMove:function(a){var c=e.position(this.containerNode),b=a.event.clientX-c.x,c=a.event.clientY-c.y;this._dragOut=!this._locationCheck(-1<this.tabPosition.indexOf("h")?c:b,a.event)},_onMoveEnd:function(a){this._movingTab=!1;this._repositionTab(this._insertLoc,a.target);this._hideIndicator()},_onRightButtonMouseOver:function(){if(this._movingTab)this._rightHover=!0,this._slide(1,1)},_onLeftButtonMouseOver:function(){if(this._movingTab)this._leftHover=!0,this._slide(-1,1)},_onScrollMouseOut:function(){this._rightHover=
this._leftHover=!1},_slide:function(a,c){var b=e.marginBox(this.getChildren()[0].domNode).w*c*a,b=this._getScroll()+b;this._setButtonClass(b);b=this.createSmoothScroll(b);b.onEnd=n.hitch(this,"_keepScrolling");b.play()},_keepScrolling:function(){var a=n.hitch(this,function(){this._rightHover?this._slide(1,1):this._leftHover&&this._slide(-1,1)});setTimeout(a,0)},_repositionTab:function(a,c){if(c&&c.page){this._tabIndex<a&&a--;var b=i.byId(this.containerId);try{b.removeChild(c.page),this._mock&&b.removeChild(this._mock)}catch(d){}b.addChild(c.page,
a);b.selectChild(c.page)}},_containsCursor:function(a){var c=e.position(this.domNode),b=c.x,d=c.y,f=b+c.w,c=d+c.h,g=a.clientX,a=a.clientY;return g>b-20&&g<f+20&&a>d-20&&a<c+20?!0:!1},_locationCheck:function(a,c){if(c&&!this._containsCursor(c))return!1;for(var b=this.isLeftToRight(),d=0,d=0;d<this._bounds.length;d++){var e=this._bounds[d];if(b){if(a<e)break}else if(a>e)break}this._showIndicatorAt(d);return!0},_showIndicatorAt:function(a){var c=this.getChildren(),b=null,b=c.length<=a?c[a-1]:c[a],d=
null;b?(d=this._getOffsetPosition(b.domNode,this.tablistWrapper),d.t-=6,d.l-=8,this.isLeftToRight()?c.length<=a&&(d.l+=e.marginBox(b.domNode).w):(c.length>a&&(d.l+=e.marginBox(b.domNode).w),c=e.marginBox(this.tablistWrapper).w-d.l-16,e.style(this._indicator,"right",c+"px")),e.marginBox(this._indicator,d),e.style(this._indicator,"display","block")):(this._mock=this._mock||new s,i.byId(this.containerId).addChild(this._mock));this._insertLoc=a},_hideIndicator:function(){e.style(this._indicator,"display",
"none")},_computeBounds:function(){this._bounds=[];for(var a=this.getChildren(),c=0;c<a.length;c++){var b=a[c];this._bounds.push(b.domNode.offsetLeft+e.marginBox(b.domNode).w/2)}},_getOffsetPosition:function(a,c){for(var b=0,d=0,e=a;e!=c;)b+=e.offsetLeft,d+=e.offsetTop,e=e.offsetParent;return{l:b,t:d}}});h=h("idx.layout.MoveableTabButton",[r.TabButton],{delay:10,page:null,_moving:!1,tabTopicId:"",postCreate:function(){this.inherited(arguments);this.connect(this.focusNode,"onmousedown","_onTabMouseDown")},
startup:function(){this.inherited(arguments);this._controller=i.getEnclosingWidget(this.domNode.parentNode)},_onTabMouseDown:function(a){this._makeSelectable(!1);this._startLoc={x:a.clientX,y:a.clientY};this._moveConnects=[this.connect(f.body(),"onmousemove","_onTabMouseMove"),this.connect(f.body(),"onmouseup","_onTabMouseUp")]},_onTabMouseUp:function(a){k.forEach(this._moveConnects,function(a){this.disconnect(a)},this);if(this._moving)this._moving=!1,l.publish(this.tabTopicId+"/idx/tab/move/end",
[{target:this,content:this.page,event:a,start:this._startLoc}]),this._startLoc=null;this._makeSelectable(!0)},_makeSelectable:function(a){dojo.isIE?a?f.body().onselectstart=this._selectHandle:(this._selectHandle=f.body().onselectstart,f.body().onselectstart=function(){return!1}):e.setSelectable(f.body(),a)},_onTabMouseMove:function(a){if(this._startLoc&&this._distanceBetween(this._startLoc,{x:a.clientX,y:a.clientY})>this.delay)a=[{target:this,content:this.page,event:a,start:this._startLoc}],this._moving?
l.publish(this.tabTopicId+"/idx/tab/move",a):(l.publish(this.tabTopicId+"/idx/tab/move/start",a),this._moving=!0)},_distanceBetween:function(a,c){var b=a.x-c.x,d=a.y-c.y;return Math.sqrt(b*b+d*d)},_setStateClass:function(){(!this._controller||!this._controller._movingTab)&&this.inherited(arguments)}});j.MoveableTabController=m;j.MoveableTabButton=h;return j});