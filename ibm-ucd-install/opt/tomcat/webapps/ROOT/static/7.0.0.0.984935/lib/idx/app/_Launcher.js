//>>built
define("idx/app/_Launcher","dojo/_base/declare,dijit/layout/_LayoutWidget,./_A11yAreaProvider,dojo/_base/lang,dojo/_base/array,dojo/aspect,dojo/topic,dojo/query,dojo/dom-construct,dojo/dom-class,dojo/dom-style,dojo/cookie,../resources,../string,../util,../bus,./Workspace,./WorkspaceType,dojo/NodeList-dom,dojo/i18n!../nls/base,dojo/i18n!./nls/base,dojo/i18n!./nls/_Launcher".split(","),function(m,n,o,f,k,p,q,r,s,t,u,h,v,g,w,j,l,x){var y=r.NodeList;return m("idx.app._Launcher",[n,o],{defaultWorkspaceTypeID:"",
stateCookieName:"",resources:null,constructor:function(){this._workspaceTypes=[];this._workspacesByType=[];this._workspacesByID=[];this._workspaceTypesByID=[];this._workspaceCallersByID=[];this._nextWorkspaceID=0;this._launcherStarted=!1;this._workspaceCount=0;this._selectedWorkspace=null;this.subscriberScopeFilter="idx.app.launcher";this.subscriberScopeRegexp=!1},destroy:function(){for(var a in this._workspaceCallersByID){var b=this._workspaceCallersByID[a];b.handle&&(b.handle.remove(),delete b.handle);
delete this._workspaceCallersByID[a]}this.inherited(arguments)},postMixInProperties:function(){var a=v.getResources("idx/app/_Launcher",this.lang);if(this.resources){var b={};f.mixin(b,a);f.mixin(b,this.resources);this.resources=b}else this.resources=a;this._initialWSTypeIDs=[];a=null;this.stateCookieName=g.nullTrim(this.stateCookieName);null!=this.stateCookieName&&(a=g.nullTrim(h(this.stateCookieName)),null!=a&&this._initialWSTypeIDs.push(a));a=g.nullTrim(this.defaultWorkspaceTypeID);null!=a&&this._initialWSTypeIDs.push(a)},
openWorkspace:function(a,b){var c=this._workspaceTypesByID[a];null==c&&j.systemError(this,"Workspace could not be opened.  Workspace type is not known: ${workspaceTypeID}",{workspaceTypeID:a},null,"Unknown workspace type: "+a,!0);var d=this.getOpenWorkspaceCount(a),e=c.get("maxOpen");if(1==e&&1==d)return c=this._workspacesByType[a][0],this.selectWorkspace(c),c;if(0<e&&d>=e)return j.userError(this,this.resources.tooManyOpenWorkspaces,{maxOpen:e,workspaceTypeName:c.workspaceTypeName},null,"Exceeded maximum open workspaces for workspace type: opened=[ "+
d+" ], maxOpen=[ "+e+" ], typeID=[ "+a+" ], typeName=[ "+c.workspaceTypeName+" ]"),null;for(var d=c.formatTitle(b),e=-1,g=this.getWorkspaces(),i=0;i<g.length;i++){var f=g[i],h=f.get("baseTitle");d==h&&(f=f.get("titleSuffixIndex"),f>e&&(e=f))}0<=e&&(e+=1,d={baseTitle:d,title:d+(" ("+e+") "),titleSuffixIndex:e});return this._doOpenWorkspace(c,d,b)},_doOpenWorkspace:function(a,b,c){var d=a.workspaceTypeID+":"+this._nextWorkspaceID++ +"-"+(1E5+Math.floor(9E5*Math.random())),b=this._createWorkspace(a,
d,b,c);t.add(b.domNode,this.getWorkspaceStyleClass());this._workspacesByID[d]=b;this._workspacesByType[a.workspaceTypeID].push(b);this.connect(b,"onDownloadEnd","resize");this._workspaceCreated(b);b.startup();return b},_createWorkspace:function(a,b,c,d){a=this._createWorkspaceArgs(a,b,c,d);a=new l(a);b={launcher:this,workspace:a,handle:null,loaded:function(a){this.launcher.workspaceLoaded(this.workspace,a);this.handle&&this.handle.remove();delete this.handle}};b.handle=p.after(a,"onLoad",f.hitch(b,
b.loaded),!0);this._workspaceCallersByID[a.workspaceID]=b;return a},_createWorkspaceArgs:function(a,b,c,d){var e={};if(g.nullTrim(this.lang))e.lang=this.lang;if(g.nullTrim(this.dir))e.dir=this.dir;var h=a.get("lang"),i=a.get("dir");if(g.nullTrim(h))e.lang=h;if(g.nullTrim(i))e.dir=i;b={workspaceID:b,workspaceTypeID:a.workspaceTypeID,workspaceArgs:d,loadingMessage:this.getLoadingMessage(a,c,d),errorMessage:this.getFailedLoadMessage(a,c,d),href:a.formatURL(d),preventCache:!0,refreshOnShow:!1,parseOnLoad:!0,
inferLabel:!1};"string"==w.typeOfObject(c)?(b.title=c,b.baseTitle=c):(b.title=c.title,b.baseTitle=c.baseTitle,b.titleSuffixIndex=c.titleSuffixIndex);if(a=a.get("workspaceArgs"))for(field in e)field in a||(b[field]=e[field]);f.mixin(b,a);return b},selectWorkspace:function(){},onWorkspaceSelected:function(){},_onWorkspaceSelected:function(a,b){if(b!==a)this._selectedWorkspace=a,this._saveStateToCookie(),this.onWorkspaceSelected(a,b)},_saveStateToCookie:function(){null!=g.nullTrim(this.stateCookieName)&&
(null==this._selectedWorkspace?h(this.stateCookieName,null,{expires:-1}):h(this.stateCookieName,this._selectedWorkspace.get("workspaceTypeID"),{expires:365}))},_selectDefaultWorkspace:function(){var a=0,b=null,c=this._initialWorkspaceTypeID;null!=c&&0<c.length&&0<this.getOpenWorkspaceCount(c)&&(b=this._workspacesByType[c],b=b[0]);for(a=0;a<this._workspaceTypes.length&&null==b;a++)c=this._workspaceTypes[a].get("workspaceTypeID"),!b&&0<this.getOpenWorkspaceCount(c)&&(b=this._workspacesByType[c],b=b[0]);
if(b)this.selectWorkspace(b),this._selectedWorkspace=b,this._saveStateToCookie()},workspaceLoaded:function(){},getWorkspaceStyleClass:function(){return this.baseClass+"_Workspace"},_workspaceCreated:function(a){this._workspaceCount++;1==this._workspaceCount&&this.selectWorkspace(a)},getFailedLoadMessage:function(a,b,c){return"<div class='dijitContentPaneError'>"+this._getFailedLoadMessage(a,b,c)+"</div>"},_getFailedLoadMessage:function(a,b,c){a=a.formatFailedLoadMessage(b,c);if(null!=a&&0<a.length)return a;
a=this.resources.failedLoadMessageTemplate;if(!a||0==a.length)return"";a=dString.substitute(a,{workspaceTitle:b});c&&(a=dString.substitute(a,c));return a},getLoadingMessage:function(a,b,c){return"<div class='dijitContentPaneLoading'>"+this._getLoadingMessage(a,b,c)+"</div>"},_getLoadingMessage:function(a,b,c){a=a.formatLoadingMessage(b,c);if(null!=a&&0<a.length)return a;a=this.resources.failedLoadMessageTemplate;if(!a||0==a.length)return"";a=dString.substitute(a,{workspaceTitle:b});c&&(a=dString.substitute(a,
c));return a},closeWorkspace:function(a){a=this._workspacesByID[a];if(!a)return null;var b=a.get("workspaceTypeID"),c=this._workspaceTypesByID[b];c||j.systemError(this,"Workspace could not be closed.  Workspace type is not known: ${workspaceTypeID}",{workspaceTypeID:b},null,"Unknown workspace type: "+b,!0);c.formatConfirmCloseMessage(a);var c=this._workspaceClosing(a),d=this._workspacesByType[b],e=k.indexOf(d,a);0<=e&&d.splice(e,1);if(d=this._workspaceCallersByID[a.workspaceID])d.handle&&(d.handle.remove(),
delete d.handle),delete this._workspaceCallersByID[a.workspaceID];c||a.destroyRecursive();this._workspaceClosed(a);return b},_workspaceClosing:function(){return!1},_workspaceClosed:function(){this._workspaceCount--},startup:function(){if(!this._launcherStarted){this.inherited(arguments);k.forEach(this.getChildren(),this._setupChild,this);this._initialWorkspaceTypeID=null;for(var a=0,a=0;a<this._initialWSTypeIDs.length&&null==this._initialWorkspaceTypeID;a++){var b=this._initialWSTypeIDs[a],c=this._workspaceTypesByID[b];
if(null!=c){var d=c.get("initialOpen");if(0<d)this._initialWorkspaceTypeID=b}}for(a=a=0;a<this._workspaceTypes.length;a++){c=this._workspaceTypes[a];d=c.get("initialOpen");for(b=b=0;b<d;b++)this.openWorkspace(c.workspaceTypeID,null)}this.launcherTopic&&0<this.launcherTopic.length&&q.subscribe(this.launcherTopic,f.hitch(this,this.handleRequest));this._selectDefaultWorkspace();this._launcherStarted=!0}},selectFirstWorkspaceOfType:function(a){a=this.getWorkspaces(a);if(!a||0==a.length)return null;a=
a[0];this.selectWorkspace(a);return a},getWorkspaceTypeIDs:function(){for(var a=[],b=0;b<this._workspaceTypes.length;b++)workspaceType=this._workspaceTypes[b],a.push(workspaceType.get("workspaceTypeID"));return a},getWorkspaces:function(a){var b=[];if(a){var c=this._workspacesByType[a];if(!c)return b;for(a=0;a<c.length;a++)b.push(c[a])}else{c=this.getChildren();for(a=0;a<c.length;a++){var d=c[a];d instanceof l&&this._workspacesByID[d.get("workspaceID")]==d&&b.push(d)}}return b},getWorkspace:function(a){return this._workspacesByID[a]},
_setupChild:function(a,b){this.inherited(arguments);if(a instanceof x){var c=a.get("workspaceTypeID");this._workspaceTypesByID[c]&&j.systemError(this,this.resources.duplicateWorkspaceTypeError,{workspaceTypeID:a.workspaceTypeID},null,"Duplicate workspace type key: "+a.workspaceTypeID,!0);this._workspaceTypes.push(a);this._workspaceTypesByID[c]=a;this._workspacesByType[c]=[];this._workspaceTypeRegistered(a);this._relocateWorkspaceType(a,b)}},_relocateWorkspaceType:function(a){(new y(a.domNode)).orphan();
s.place(a.domNode,this.containerNode,"last");u.set(a.domNode,{visibility:"hidden",display:"none"})},_workspaceTypeRegistered:function(){},getOpenWorkspaceCount:function(a){a=this._workspacesByType[a];return!a?0:a.length},getMaxOpenWorkspaceCount:function(a){a=this._workspaceTypesByName[a];return!a?-1:a.get("maxOpen")}})});